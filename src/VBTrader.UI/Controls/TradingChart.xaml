<UserControl
    x:Class="VBTrader.UI.Controls.TradingChart"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:lvc="using:LiveChartsCore.SkiaSharpView.WinUI">

    <Grid Background="{StaticResource ChartBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="100" />
            <RowDefinition Height="80" />
        </Grid.RowDefinitions>

        <!-- Main Candlestick Chart -->
        <Border Grid.Row="0"
                BorderBrush="{StaticResource TradingBorder}"
                BorderThickness="0,0,0,1">
            <Grid>
                <!-- Chart -->
                <lvc:CartesianChart
                    Series="{x:Bind ViewModel.CandlestickSeries}"
                    XAxes="{x:Bind ViewModel.XAxes}"
                    YAxes="{x:Bind ViewModel.YAxes}"
                    Background="{StaticResource ChartBackground}"
                    AnimationsSpeed="0"
                    TooltipPosition="Hidden"
                    ZoomMode="X" />

                <!-- Loading Indicator -->
                <Border Background="#AA000000"
                        Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="10">
                        <ProgressRing IsActive="True" Width="40" Height="40" />
                        <TextBlock Text="Loading chart data..."
                                   Foreground="White"
                                   HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

                <!-- Chart Controls -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="10"
                            Spacing="5">
                    <ComboBox x:Name="TimeFrameComboBox"
                              SelectedIndex="0"
                              SelectionChanged="TimeFrameComboBox_SelectionChanged"
                              MinWidth="80">
                        <ComboBoxItem Content="1m" Tag="1" />
                        <ComboBoxItem Content="5m" Tag="5" />
                        <ComboBoxItem Content="15m" Tag="15" />
                        <ComboBoxItem Content="30m" Tag="30" />
                        <ComboBoxItem Content="1h" Tag="60" />
                        <ComboBoxItem Content="4h" Tag="240" />
                        <ComboBoxItem Content="1d" Tag="1440" />
                    </ComboBox>

                    <Button Content="ðŸ“ˆ"
                            ToolTipService.ToolTip="Refresh Chart"
                            Click="RefreshButton_Click"
                            Style="{StaticResource DefaultButtonStyle}"
                            Width="32"
                            Height="32" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Volume Chart -->
        <Border Grid.Row="1"
                BorderBrush="{StaticResource TradingBorder}"
                BorderThickness="0,0,0,1">
            <Grid>
                <lvc:CartesianChart
                    Series="{x:Bind ViewModel.VolumeSeries}"
                    XAxes="{x:Bind ViewModel.XAxes}"
                    YAxes="{x:Bind ViewModel.VolumeYAxes}"
                    Background="{StaticResource ChartBackground}"
                    AnimationsSpeed="0"
                    TooltipPosition="Hidden"
                    ZoomMode="X" />

                <TextBlock Text="VOLUME"
                           FontSize="10"
                           FontWeight="Bold"
                           Foreground="{StaticResource TradingMutedForeground}"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Top"
                           Margin="10,5" />
            </Grid>
        </Border>

        <!-- MACD Chart -->
        <Border Grid.Row="2">
            <Grid>
                <lvc:CartesianChart
                    Series="{x:Bind ViewModel.MACDSeries}"
                    XAxes="{x:Bind ViewModel.XAxes}"
                    YAxes="{x:Bind ViewModel.MACDYAxes}"
                    Background="{StaticResource ChartBackground}"
                    AnimationsSpeed="0"
                    TooltipPosition="Hidden"
                    ZoomMode="X" />

                <TextBlock Text="MACD"
                           FontSize="10"
                           FontWeight="Bold"
                           Foreground="{StaticResource TradingMutedForeground}"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Top"
                           Margin="10,5" />

                <!-- MACD Settings -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="10,5"
                            Spacing="5">
                    <TextBlock Text="MACD("
                               FontSize="9"
                               Foreground="{StaticResource TradingMutedForeground}"
                               VerticalAlignment="Center" />
                    <TextBlock Text="{x:Bind ViewModel.MacdSettings.FastPeriod, Mode=OneWay}"
                               FontSize="9"
                               Foreground="{StaticResource MACDLine}"
                               VerticalAlignment="Center" />
                    <TextBlock Text=","
                               FontSize="9"
                               Foreground="{StaticResource TradingMutedForeground}"
                               VerticalAlignment="Center" />
                    <TextBlock Text="{x:Bind ViewModel.MacdSettings.SlowPeriod, Mode=OneWay}"
                               FontSize="9"
                               Foreground="{StaticResource MACDSignal}"
                               VerticalAlignment="Center" />
                    <TextBlock Text=","
                               FontSize="9"
                               Foreground="{StaticResource TradingMutedForeground}"
                               VerticalAlignment="Center" />
                    <TextBlock Text="{x:Bind ViewModel.MacdSettings.SignalPeriod, Mode=OneWay}"
                               FontSize="9"
                               Foreground="{StaticResource MACDHistogram}"
                               VerticalAlignment="Center" />
                    <TextBlock Text=")"
                               FontSize="9"
                               Foreground="{StaticResource TradingMutedForeground}"
                               VerticalAlignment="Center" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Status Message -->
        <Border Grid.Row="0"
                Background="Transparent"
                Visibility="{x:Bind ViewModel.StatusMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}"
                HorizontalAlignment="Center"
                VerticalAlignment="Bottom"
                Margin="0,0,0,20">
            <Border Background="#DD000000"
                    CornerRadius="15"
                    Padding="10,5">
                <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                           Foreground="White"
                           FontSize="11"
                           HorizontalAlignment="Center" />
            </Border>
        </Border>
    </Grid>
</UserControl>