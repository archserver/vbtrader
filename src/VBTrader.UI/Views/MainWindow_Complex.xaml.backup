<Window
    x:Class="VBTrader.UI.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:models="using:VBTrader.Core.Models"
    xmlns:converters="using:VBTrader.UI.Converters">

    <Grid Background="{StaticResource TradingDarkBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Top Menu Bar -->
        <Border Grid.Row="0"
                Background="{StaticResource TradingPanelBackground}"
                BorderBrush="{StaticResource TradingBorder}"
                BorderThickness="0,0,0,1"
                Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Logo and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                    <TextBlock Text="VBTrader Pro"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="{StaticResource TradingBlue}"
                               VerticalAlignment="Center" />
                </StackPanel>

                <!-- Status Indicators -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="24"
                            HorizontalAlignment="Center">
                    <!-- Connection Status -->
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <Ellipse Width="8" Height="8"
                                 Fill="{x:Bind ViewModel.IsConnected, Mode=OneWay, Converter={StaticResource BoolToStatusColorConverter}}"
                                 VerticalAlignment="Center" />
                        <TextBlock Text="{x:Bind ViewModel.ConnectionStatus, Mode=OneWay}"
                                   FontSize="12"
                                   Foreground="{StaticResource TradingSecondaryForeground}"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Market Status -->
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="📈"
                                   FontSize="12"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="{x:Bind ViewModel.MarketStatus, Mode=OneWay}"
                                   FontSize="12"
                                   Foreground="{StaticResource TradingSecondaryForeground}"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Symbols Watched -->
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="👁"
                                   FontSize="12"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="{x:Bind ViewModel.TotalSymbolsWatched, Mode=OneWay}"
                                   FontSize="12"
                                   Foreground="{StaticResource TradingSecondaryForeground}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="watching"
                                   FontSize="12"
                                   Foreground="{StaticResource TradingMutedForeground}"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Opportunities -->
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="🎯"
                                   FontSize="12"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="{x:Bind ViewModel.TotalOpportunities, Mode=OneWay}"
                                   FontSize="12"
                                   Foreground="{StaticResource TradingOrange}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="opportunities"
                                   FontSize="12"
                                   Foreground="{StaticResource TradingMutedForeground}"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                    <Button Content="Connect"
                            Command="{x:Bind ViewModel.ConnectCommand}"
                            Style="{StaticResource AccentButtonStyle}"
                            Visibility="{x:Bind ViewModel.IsConnected, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}" />

                    <Button Content="Disconnect"
                            Command="{x:Bind ViewModel.DisconnectCommand}"
                            Style="{StaticResource DefaultButtonStyle}"
                            Visibility="{x:Bind ViewModel.IsConnected, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />

                    <Button Content="🔄"
                            ToolTipService.ToolTip="Refresh Data"
                            Command="{x:Bind ViewModel.RefreshDataCommand}"
                            Style="{StaticResource DefaultButtonStyle}"
                            Width="32" />

                    <Button Content="⚙"
                            ToolTipService.ToolTip="Settings"
                            Command="{x:Bind ViewModel.OpenSettingsCommand}"
                            Style="{StaticResource DefaultButtonStyle}"
                            Width="32" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Trading Interface -->
        <Grid Grid.Row="1" Margin="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350" />
                <ColumnDefinition Width="4" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Market Data & Opportunities -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="4" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Top Movers / Watch List -->
                <Border Grid.Row="0" Style="{StaticResource TradingPanelStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <TextBlock Grid.Row="0"
                                   Text="TOP MOVERS"
                                   FontWeight="Bold"
                                   FontSize="14"
                                   Foreground="{StaticResource TradingForeground}"
                                   Margin="0,0,0,8" />

                        <!-- Data Grid -->
                        <controls:DataGrid Grid.Row="1"
                                           ItemsSource="{x:Bind ViewModel.TopMovers}"
                                           Style="{StaticResource TradingDataGridStyle}">
                            <controls:DataGrid.Columns>
                                <controls:DataGridTextColumn Header="Symbol"
                                                             Binding="{Binding Symbol}"
                                                             Width="60" />
                                <controls:DataGridTextColumn Header="Last"
                                                             Binding="{Binding LastPrice, Converter={StaticResource CurrencyConverter}}"
                                                             Width="70" />
                                <controls:DataGridTextColumn Header="Chg"
                                                             Binding="{Binding Change, Converter={StaticResource CurrencyConverter}}"
                                                             Width="60">
                                    <controls:DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="{Binding Change, Converter={StaticResource NumberToColorConverter}}" />
                                        </Style>
                                    </controls:DataGridTextColumn.ElementStyle>
                                </controls:DataGridTextColumn>
                                <controls:DataGridTextColumn Header="Chg%"
                                                             Binding="{Binding ChangePercent, Converter={StaticResource PercentageConverter}}"
                                                             Width="60">
                                    <controls:DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="{Binding ChangePercent, Converter={StaticResource NumberToColorConverter}}" />
                                        </Style>
                                    </controls:DataGridTextColumn.ElementStyle>
                                </controls:DataGridTextColumn>
                                <controls:DataGridTextColumn Header="Volume"
                                                             Binding="{Binding Volume, Converter={StaticResource VolumeToFormattedStringConverter}}"
                                                             Width="70" />
                            </controls:DataGrid.Columns>
                        </controls:DataGrid>
                    </Grid>
                </Border>

                <!-- Splitter -->
                <Border Grid.Row="1" Background="{StaticResource TradingBorder}" />

                <!-- Opportunities -->
                <Border Grid.Row="2" Style="{StaticResource TradingPanelStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <TextBlock Grid.Row="0"
                                   Text="OPPORTUNITIES"
                                   FontWeight="Bold"
                                   FontSize="14"
                                   Foreground="{StaticResource TradingOrange}"
                                   Margin="0,0,0,8" />

                        <!-- Opportunities List -->
                        <ListView Grid.Row="1"
                                  ItemsSource="{x:Bind ViewModel.Opportunities}"
                                  Background="Transparent"
                                  SelectionMode="Single">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="models:MarketOpportunity">
                                    <Border Background="{StaticResource TradingCardBackground}"
                                            CornerRadius="4"
                                            Padding="8"
                                            Margin="0,2">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0" Spacing="4">
                                                <TextBlock Text="{x:Bind Symbol}"
                                                           FontWeight="Bold"
                                                           FontSize="14"
                                                           Foreground="{StaticResource TradingForeground}" />
                                                <TextBlock Text="{x:Bind Reason}"
                                                           FontSize="11"
                                                           Foreground="{StaticResource TradingSecondaryForeground}"
                                                           TextWrapping="Wrap" />
                                            </StackPanel>

                                            <StackPanel Grid.Column="1" HorizontalAlignment="Right" Spacing="2">
                                                <TextBlock Text="{x:Bind Score, Converter={StaticResource ScoreConverter}}"
                                                           FontWeight="Bold"
                                                           FontSize="12"
                                                           Foreground="{StaticResource TradingBlue}"
                                                           HorizontalAlignment="Right" />
                                                <TextBlock Text="{x:Bind PriceChangePercent, Converter={StaticResource PercentageConverter}}"
                                                           FontSize="11"
                                                           Foreground="{x:Bind PriceChangePercent, Converter={StaticResource NumberToColorConverter}}"
                                                           HorizontalAlignment="Right" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>
                </Border>
            </Grid>

            <!-- Vertical Splitter -->
            <Border Grid.Column="1" Background="{StaticResource TradingBorder}" />

            <!-- Right Panel - Charts & Active Trading -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="4" />
                    <RowDefinition Height="200" />
                </Grid.RowDefinitions>

                <!-- Active Trading Charts -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="4" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="4" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Stock 1 Chart -->
                    <Border Grid.Column="0" Style="{StaticResource ChartContainerStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Stock 1 Header -->
                            <Border Grid.Row="0"
                                    Background="{StaticResource TradingPanelBackground}"
                                    Padding="8,4">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock1.Symbol, Mode=OneWay, FallbackValue='---'}"
                                                   FontWeight="Bold"
                                                   FontSize="16"
                                                   Foreground="{StaticResource TradingForeground}" />
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock1.LastPrice, Mode=OneWay, Converter={StaticResource CurrencyConverter}, FallbackValue='$0.00'}"
                                                   FontSize="14"
                                                   FontFamily="Consolas"
                                                   Foreground="{StaticResource TradingSecondaryForeground}" />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock1.Change, Mode=OneWay, Converter={StaticResource CurrencySignedConverter}, FallbackValue='+$0.00'}"
                                                   FontSize="12"
                                                   FontFamily="Consolas"
                                                   Foreground="{x:Bind ViewModel.ActiveStock1.Change, Mode=OneWay, Converter={StaticResource NumberToColorConverter}}" />
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock1.ChangePercent, Mode=OneWay, Converter={StaticResource PercentageSignedConverter}, FallbackValue='+0.00%'}"
                                                   FontSize="12"
                                                   FontFamily="Consolas"
                                                   Foreground="{x:Bind ViewModel.ActiveStock1.ChangePercent, Mode=OneWay, Converter={StaticResource NumberToColorConverter}}" />
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Chart Area 1 -->
                            <Border Grid.Row="1" Background="{StaticResource ChartBackground}">
                                <!-- TODO: LiveCharts candlestick chart will go here -->
                                <TextBlock Text="Chart 1"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           Foreground="{StaticResource TradingMutedForeground}" />
                            </Border>

                            <!-- Trading Controls 1 -->
                            <Grid Grid.Row="2" Padding="8,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0"
                                        Content="BUY"
                                        Style="{StaticResource BuyButtonStyle}"
                                        Margin="0,0,2,0"
                                        ToolTipService.ToolTip="Alt+1: Buy 100 | Shift+Alt+1: Buy 1000" />

                                <Button Grid.Column="1"
                                        Content="SELL"
                                        Style="{StaticResource SellButtonStyle}"
                                        Margin="2,0,0,0"
                                        ToolTipService.ToolTip="Ctrl+1: Sell 100 | Shift+Ctrl+1: Sell All" />
                            </Grid>
                        </Grid>
                    </Border>

                    <!-- Stock 2 Chart -->
                    <Border Grid.Column="1" Background="{StaticResource TradingBorder}" />

                    <Border Grid.Column="2" Style="{StaticResource ChartContainerStyle}">
                        <!-- Similar structure as Stock 1, but for Stock 2 -->
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0"
                                    Background="{StaticResource TradingPanelBackground}"
                                    Padding="8,4">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock2.Symbol, Mode=OneWay, FallbackValue='---'}"
                                                   FontWeight="Bold"
                                                   FontSize="16"
                                                   Foreground="{StaticResource TradingForeground}" />
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock2.LastPrice, Mode=OneWay, Converter={StaticResource CurrencyConverter}, FallbackValue='$0.00'}"
                                                   FontSize="14"
                                                   FontFamily="Consolas"
                                                   Foreground="{StaticResource TradingSecondaryForeground}" />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock2.Change, Mode=OneWay, Converter={StaticResource CurrencySignedConverter}, FallbackValue='+$0.00'}"
                                                   FontSize="12"
                                                   FontFamily="Consolas"
                                                   Foreground="{x:Bind ViewModel.ActiveStock2.Change, Mode=OneWay, Converter={StaticResource NumberToColorConverter}}" />
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock2.ChangePercent, Mode=OneWay, Converter={StaticResource PercentageSignedConverter}, FallbackValue='+0.00%'}"
                                                   FontSize="12"
                                                   FontFamily="Consolas"
                                                   Foreground="{x:Bind ViewModel.ActiveStock2.ChangePercent, Mode=OneWay, Converter={StaticResource NumberToColorConverter}}" />
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <Border Grid.Row="1" Background="{StaticResource ChartBackground}">
                                <TextBlock Text="Chart 2"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           Foreground="{StaticResource TradingMutedForeground}" />
                            </Border>

                            <Grid Grid.Row="2" Padding="8,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0"
                                        Content="BUY"
                                        Style="{StaticResource BuyButtonStyle}"
                                        Margin="0,0,2,0"
                                        ToolTipService.ToolTip="Alt+2: Buy 100 | Shift+Alt+2: Buy 1000" />

                                <Button Grid.Column="1"
                                        Content="SELL"
                                        Style="{StaticResource SellButtonStyle}"
                                        Margin="2,0,0,0"
                                        ToolTipService.ToolTip="Ctrl+2: Sell 100 | Shift+Ctrl+2: Sell All" />
                            </Grid>
                        </Grid>
                    </Border>

                    <!-- Stock 3 Chart -->
                    <Border Grid.Column="3" Background="{StaticResource TradingBorder}" />

                    <Border Grid.Column="4" Style="{StaticResource ChartContainerStyle}">
                        <!-- Similar structure for Stock 3 -->
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0"
                                    Background="{StaticResource TradingPanelBackground}"
                                    Padding="8,4">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock3.Symbol, Mode=OneWay, FallbackValue='---'}"
                                                   FontWeight="Bold"
                                                   FontSize="16"
                                                   Foreground="{StaticResource TradingForeground}" />
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock3.LastPrice, Mode=OneWay, Converter={StaticResource CurrencyConverter}, FallbackValue='$0.00'}"
                                                   FontSize="14"
                                                   FontFamily="Consolas"
                                                   Foreground="{StaticResource TradingSecondaryForeground}" />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock3.Change, Mode=OneWay, Converter={StaticResource CurrencySignedConverter}, FallbackValue='+$0.00'}"
                                                   FontSize="12"
                                                   FontFamily="Consolas"
                                                   Foreground="{x:Bind ViewModel.ActiveStock3.Change, Mode=OneWay, Converter={StaticResource NumberToColorConverter}}" />
                                        <TextBlock Text="{x:Bind ViewModel.ActiveStock3.ChangePercent, Mode=OneWay, Converter={StaticResource PercentageSignedConverter}, FallbackValue='+0.00%'}"
                                                   FontSize="12"
                                                   FontFamily="Consolas"
                                                   Foreground="{x:Bind ViewModel.ActiveStock3.ChangePercent, Mode=OneWay, Converter={StaticResource NumberToColorConverter}}" />
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <Border Grid.Row="1" Background="{StaticResource ChartBackground}">
                                <TextBlock Text="Chart 3"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           Foreground="{StaticResource TradingMutedForeground}" />
                            </Border>

                            <Grid Grid.Row="2" Padding="8,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0"
                                        Content="BUY"
                                        Style="{StaticResource BuyButtonStyle}"
                                        Margin="0,0,2,0"
                                        ToolTipService.ToolTip="Alt+3: Buy 100 | Shift+Alt+3: Buy 1000" />

                                <Button Grid.Column="1"
                                        Content="SELL"
                                        Style="{StaticResource SellButtonStyle}"
                                        Margin="2,0,0,0"
                                        ToolTipService.ToolTip="Ctrl+3: Sell 100 | Shift+Ctrl+3: Sell All" />
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>

                <!-- Horizontal Splitter -->
                <Border Grid.Row="1" Background="{StaticResource TradingBorder}" />

                <!-- Bottom Panel - News & Analysis -->
                <Border Grid.Row="2" Style="{StaticResource TradingPanelStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="NEWS ANALYSIS"
                                   FontWeight="Bold"
                                   FontSize="14"
                                   Foreground="{StaticResource TradingForeground}"
                                   Margin="0,0,0,8" />

                        <ScrollViewer Grid.Row="1">
                            <TextBlock Text="Real-time news analysis will appear here..."
                                       Foreground="{StaticResource TradingMutedForeground}"
                                       TextWrapping="Wrap" />
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{StaticResource TradingPanelBackground}"
                BorderBrush="{StaticResource TradingBorder}"
                BorderThickness="0,1,0,0"
                Padding="12,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="VBTrader Pro - Professional Trading Platform"
                           FontSize="11"
                           Foreground="{StaticResource TradingMutedForeground}"
                           VerticalAlignment="Center" />

                <TextBlock Grid.Column="1"
                           Text="{x:Bind ViewModel.LastUpdate, Mode=OneWay, Converter={StaticResource DateTimeConverter}}"
                           FontSize="11"
                           Foreground="{StaticResource TradingMutedForeground}"
                           VerticalAlignment="Center" />
            </Grid>
        </Border>
    </Grid>
</Window>